---
created: 2026-02-17
project: file-server
version: v1
previous_version: null
status: ready
---

# ファイルサーバー一覧画面レイアウト改善

## 背景・課題
現在のファイルサーバー一覧画面では、ファイル一覧の下にフォルダ作成フォームとアップロードフォームがある。
ファイル数が多いと、アクションボタンまでスクロールが必要でUXが悪い。

## 目標
- アクション系UI（フォルダ作成、アップロード）をファイル一覧の**上に**配置
- 次フェーズで実装予定の「テキストファイル作成」機能も考慮したレイアウトにする
- テキスト作成機能は今回はボタンのみ配置（実装は別プラン）
- ファイルドラッグアンドドロップ対応を追加

## 実装案：アコーディオン式＋ドラッグアンドドロップ

### レイアウト構成
```
📁 パンくず
┌─────────────────────────────────────────────────────────┐
│ [📝 New File]  [📁 New Folder]  [⬆️ Upload]             │  ← アクションボタン群
└─────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────┐
│ （クリックしたボタンのフォームが展開される）              │  ← アコーディオン領域
│                                                         │
│  Uploadの場合：                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │      📁 ここにファイルをドラッグ＆ドロップ        │   │  ← ドロップゾーン
│  │              または                              │   │
│  │         [ファイルを選択]                         │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
📄 ファイル一覧（ドラッグ＆ドロップ可能領域）
```

### 変更対象ファイル
- `/workspaces/monorepo/projects/file-server/src/components/FileList.tsx`

### 実装詳細

#### 1. アクションボタン群の追加（パンくずの下、ファイル一覧の上）
```tsx
<div className="flex gap-3 mb-4">
  <button className="..." disabled>📝 New File</button>
  <button className="..." hx-on:click="...">📁 New Folder</button>
  <button className="..." hx-on:click="...">⬆️ Upload</button>
</div>
```

#### 2. アコーディオン機能
- 各ボタンに `hx-on:click` で対応するフォームの表示/非表示を切り替え
- 開いているフォーム以外は自動的に閉じる（排他制御）
- フォーム表示時に入力欄にフォーカス

#### 3. ドラッグアンドドロップ対応
- ドロップゾーンをUploadフォーム内に配置
- ファイル一覧エリア全体もドロップ可能に（オプション）
- ドラッグ中のビジュアルフィードバック（枠線の色変更など）
- htmxの `hx-post` で `/api/upload` に送信

#### 4. フォームの移動
- 現在：ファイル一覧の下（line 145-197）
- 変更後：ファイル一覧の上（アコーディオン領域内）

### 将来のテキスト作成機能対応
- 「New File」ボタンは今回 disabled または coming soon 表示
- 次のプランで `/api/create-text` エンドポイントとフォームを実装

## 技術的考慮事項

### htmxとの連携
- ドラッグアンドドロップはJavaScriptで処理し、FormDataを構築
- htmx.ajax() を使用して非同期アップロード
- アップロード完了後に `#file-list-container` を更新

### スタイル
- 既存のグラデーション・ボーダーデザインを維持
- ドラッグ中は `border-purple-500 bg-purple-50` などの視覚的フィードバック

## 検証手順
1. ファイル一覧が表示されることを確認
2. アクションボタン（New File, New Folder, Upload）がファイル一覧の上に表示されることを確認
3. New Fileボタンがdisabled状態であることを確認
4. New Folderボタンをクリックするとフォルダ作成フォームが展開されることを確認
5. Uploadボタンをクリックするとアップロードフォーム（ドロップゾーン付き）が展開されることを確認
6. ドラッグアンドドロップでファイルアップロードができることを確認
7. 従来のファイル選択でもアップロードができることを確認
8. フォルダ作成が正常に動作することを確認
